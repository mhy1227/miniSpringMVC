# MiniSpring MVC é¡¹ç›®è¿›åº¦

## ä¸€ã€é¡¹ç›®å‡†å¤‡çŠ¶æ€

### 1.1 åŸºç¡€ç¯å¢ƒ âœ…
- [x] JDK 8+ é…ç½®
- [x] Maven 3.6+ é…ç½®
- [x] IDE é…ç½®
- [x] Git é…ç½®
- [x] Tomcat 8+ é…ç½®

### 1.2 é¡¹ç›®é…ç½® âœ…
- [x] pom.xml ä¾èµ–é…ç½®
- [x] .gitignore é…ç½®
- [x] README.md æ–‡æ¡£
- [x] å¼€å‘è§„èŒƒæ–‡æ¡£
- [x] APIè®¾è®¡æ–‡æ¡£

### 1.3 é¡¹ç›®ç»“æ„ âœ…
- [x] åŸºç¡€ç›®å½•ç»“æ„
- [x] æ ¸å¿ƒåŒ…ç»“æ„
  - com.minispring.core.annotation
  - com.minispring.core.bean
  - com.minispring.core.web
  - com.minispring.core.util
- [x] é…ç½®æ–‡ä»¶
  - web.xml (å·²åˆ›å»º)
  - application.properties (å·²åˆ›å»º)
- [x] æµ‹è¯•ç›®å½•
  - src/test/java
  - src/test/resources

## äºŒã€æ ¸å¿ƒåŠŸèƒ½å¼€å‘è®¡åˆ’

### 2.1 æ³¨è§£æ¨¡å— ğŸ“
- [x] @Controller
  - åŠŸèƒ½ï¼šæ ‡è®°æ§åˆ¶å™¨ç±»
  - çŠ¶æ€ï¼šå·²å®ç°
  
- [x] @Service
  - åŠŸèƒ½ï¼šæ ‡è®°æœåŠ¡ç±»
  - çŠ¶æ€ï¼šå·²å®ç°
  
- [x] @Autowired
  - åŠŸèƒ½ï¼šä¾èµ–æ³¨å…¥
  - çŠ¶æ€ï¼šå·²å®ç°
  
- [x] @RequestMapping
  - åŠŸèƒ½ï¼šURLæ˜ å°„
  - çŠ¶æ€ï¼šå·²å®ç°

- [x] @Component
  - åŠŸèƒ½ï¼šåŸºç¡€ç»„ä»¶æ³¨è§£
  - çŠ¶æ€ï¼šå·²å®ç°

### 2.2 IoCå®¹å™¨ ğŸ“
- [x] BeanFactory
  - åŠŸèƒ½ï¼šBeanå·¥å‚æ¥å£
  - çŠ¶æ€ï¼šåŸºç¡€åŠŸèƒ½å·²å®ç°
    - å®ŒæˆBeançš„åŸºæœ¬ç®¡ç†
    - å®ç°ä¾èµ–æ³¨å…¥ï¼ˆå­—æ®µæ³¨å…¥ï¼‰
    - æ”¯æŒå•ä¾‹å’ŒåŸå‹ä½œç”¨åŸŸ
  
- [x] ApplicationContext
  - åŠŸèƒ½ï¼šåº”ç”¨ä¸Šä¸‹æ–‡
  - çŠ¶æ€ï¼šå·²å®ç°
    - å®ŒæˆBeançš„æ‰«æå’Œæ³¨å†Œ
    - å®ç°Beançš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
    - æ”¯æŒBeançš„åˆå§‹åŒ–å’Œé”€æ¯
    - æä¾›åº”ç”¨ä¸Šä¸‹æ–‡çŠ¶æ€ç®¡ç†
  
- [x] BeanDefinition
  - åŠŸèƒ½ï¼šBeanå®šä¹‰
  - çŠ¶æ€ï¼šå·²å®ç°

### 2.3 MVCæ ¸å¿ƒ ğŸ“
- [x] DispatcherServlet
  - åŠŸèƒ½ï¼šæ ¸å¿ƒåˆ†å‘å™¨
  - çŠ¶æ€ï¼šåŸºç¡€åŠŸèƒ½å·²å®ç°
    - æ”¯æŒé…ç½®æ–‡ä»¶åŠ è½½
    - é›†æˆApplicationContext
    - é›†æˆHandlerMapping
    - åŸºæœ¬çš„è¯·æ±‚åˆ†å‘
    - ç®€å•çš„å“åº”å¤„ç†
    - ç”Ÿå‘½å‘¨æœŸç®¡ç†
  
- [x] HandlerMapping
  - åŠŸèƒ½ï¼šå¤„ç†å™¨æ˜ å°„
  - çŠ¶æ€ï¼šå·²å®ç°
    - æ”¯æŒç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«çš„@RequestMapping
    - æ”¯æŒURLåˆ°å¤„ç†æ–¹æ³•çš„æ˜ å°„
    - æä¾›å¤„ç†å™¨æ‰§è¡Œé“¾
    - URLè·¯å¾„æ ‡å‡†åŒ–å¤„ç†
    - é‡å¤URLæ£€æµ‹
    - çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–
  
- [x] ViewResolver
  - åŠŸèƒ½ï¼šè§†å›¾è§£æå™¨
  - çŠ¶æ€ï¼šåŸºç¡€åŠŸèƒ½å·²å®ç°
    - å®Œæˆ View æ¥å£å®šä¹‰
    - å®Œæˆ ViewResolver æ¥å£å®šä¹‰
    - å®ç° JSP è§†å›¾æ”¯æŒ
    - æ”¯æŒè§†å›¾å‰ç¼€å’Œåç¼€é…ç½®
    - é›†æˆåˆ° DispatcherServlet

### 2.4 å·¥å…·ç±» ğŸ“
- [x] ClassScanner
  - åŠŸèƒ½ï¼šç±»æ‰«æå™¨
  - çŠ¶æ€ï¼šåŸºç¡€åŠŸèƒ½å·²å®ç°
    - æ”¯æŒæ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰ç±»
    - æ”¯æŒæŒ‰æ³¨è§£è¿‡æ»¤ç±»
  
- [x] ReflectionUtil
  - åŠŸèƒ½ï¼šåå°„å·¥å…·ç±»
  - çŠ¶æ€ï¼šå·²å®ç°

### 2.5 MVCåŠŸèƒ½å¢å¼º
- [ ] è¯·æ±‚å‚æ•°ç»‘å®š
  - åŠŸèƒ½ï¼šå°†HTTPè¯·æ±‚å‚æ•°ç»‘å®šåˆ°æ§åˆ¶å™¨æ–¹æ³•å‚æ•°
  - çŠ¶æ€ï¼šåŸºç¡€è®¾æ–½å·²å®Œæˆ
    - âœ… @RequestParam æ³¨è§£å®šä¹‰
    - âœ… MethodParameter å‚æ•°å°è£…ç±»
    - âœ… HandlerMethodArgumentResolver æ¥å£
    - âš ï¸ RequestParamArgumentResolver å®ç°ä¸­
    - âš ï¸ å‚æ•°è§£æå™¨é›†æˆåˆ° DispatcherServlet
- [ ] JSONå“åº”å¤„ç†
  - åŠŸèƒ½ï¼šæ”¯æŒJSONæ ¼å¼çš„å“åº”æ•°æ®
  - çŠ¶æ€ï¼šå¾…å®ç°
- [ ] å¼‚å¸¸å¤„ç†æœºåˆ¶
  - åŠŸèƒ½ï¼šç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†
  - çŠ¶æ€ï¼šå¾…å®ç°

## ä¸‰ã€æµ‹è¯•è®¡åˆ’

### 3.1 å•å…ƒæµ‹è¯• ğŸ“
- [ ] æ³¨è§£æµ‹è¯•
- [ ] IoCå®¹å™¨æµ‹è¯•
- [ ] MVCåŠŸèƒ½æµ‹è¯•
- [ ] å·¥å…·ç±»æµ‹è¯•

### 3.2 é›†æˆæµ‹è¯• ğŸ“
- [ ] Webç¯å¢ƒæµ‹è¯•
- [ ] å®Œæ•´æµç¨‹æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

## å››ã€ç¤ºä¾‹åº”ç”¨å¼€å‘

### 4.1 åŸºç¡€CRUDç¤ºä¾‹ ğŸ“
- [ ] ç”¨æˆ·ç®¡ç†æ¨¡å—
- [ ] RESTful API
- [ ] é¡µé¢æ¨¡æ¿

### 4.2 é«˜çº§ç‰¹æ€§ç¤ºä¾‹ ğŸ“
- [ ] æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- [ ] JSONæ•°æ®äº¤äº’
- [ ] æ‹¦æˆªå™¨ç¤ºä¾‹

## äº”ã€æ–‡æ¡£ç¼–å†™

### 5.1 æŠ€æœ¯æ–‡æ¡£ ğŸ“
- [ ] æ¶æ„è®¾è®¡æ–‡æ¡£
- [ ] APIæ–‡æ¡£
- [ ] æµ‹è¯•æŠ¥å‘Š

### 5.2 ä½¿ç”¨æ–‡æ¡£ ğŸ“
- [ ] å®‰è£…éƒ¨ç½²æŒ‡å—
- [ ] ä½¿ç”¨æ•™ç¨‹
- [ ] å¸¸è§é—®é¢˜

## å…­ã€å‘å¸ƒè®¡åˆ’

### 6.1 v1.0ç‰ˆæœ¬ ğŸ“…
- [ ] æ ¸å¿ƒåŠŸèƒ½å®Œæˆ
- [ ] æ–‡æ¡£å®Œå–„
- [ ] ç¤ºä¾‹åº”ç”¨
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

### 6.2 v1.1ç‰ˆæœ¬ ğŸ“…
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] åŠŸèƒ½æ‰©å±•
- [ ] Bugä¿®å¤

## å›¾ä¾‹
- âœ… å·²å®Œæˆ
- âš ï¸ è¿›è¡Œä¸­
- ğŸ“ å¾…å¼€å§‹
- ğŸ“… è®¡åˆ’ä¸­

## åä¸€ã€é—®é¢˜è®°å½•ä¸è§£å†³æ–¹æ¡ˆ

### 11.1 æ³¨è§£ç±»å®ä¾‹åŒ–é—®é¢˜
#### é—®é¢˜æè¿°
åœ¨å°†é¡¹ç›®ä» javax.servlet è¿ç§»åˆ° jakarta.servlet åï¼Œå¯åŠ¨ Tomcat 10.1.28 æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š
```
java.lang.NoSuchMethodException: com.minispring.core.annotation.Controller.<init>()
```

é”™è¯¯åŸå› ï¼šåœ¨ç»„ä»¶æ‰«æè¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿé”™è¯¯åœ°å°è¯•å®ä¾‹åŒ–æ³¨è§£ç±»å‹ï¼ˆå¦‚ @Controllerã€@Component ç­‰ï¼‰ã€‚è¿™æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºæ³¨è§£ç±»å‹ä¸åº”è¯¥è¢«å®ä¾‹åŒ–ã€‚

#### è§£å†³æ–¹æ¡ˆ
ä¿®æ”¹ `ClassScanner` ç±»çš„ `scanWithAnnotation` æ–¹æ³•ï¼Œæ·»åŠ å¯¹æ³¨è§£ç±»å‹çš„è¿‡æ»¤ï¼š
```java
public static List<Class<?>> scanWithAnnotation(String basePackage, 
        Class<? extends Annotation> annotation) throws Exception {
    List<String> classNames = scanPackage(basePackage);
    List<Class<?>> result = new ArrayList<>();
    
    for (String className : classNames) {
        Class<?> clazz = Class.forName(className);
        // æ·»åŠ  !clazz.isAnnotation() æ¡ä»¶æ¥è¿‡æ»¤æ‰æ³¨è§£ç±»å‹
        if (!clazz.isAnnotation() && clazz.isAnnotationPresent(annotation)) {
            result.add(clazz);
        }
    }
    
    return result;
}
```

#### æŠ€æœ¯è¦ç‚¹
1. ä½¿ç”¨ `Class.isAnnotation()` æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦ä¸ºæ³¨è§£ç±»å‹
2. åœ¨æ‰«æå¸¦æœ‰ @Component æ³¨è§£çš„ç±»æ—¶ï¼Œç¡®ä¿ä¸åŒ…å«æ³¨è§£ç±»å‹æœ¬èº«
3. è¿™ä¸ªä¿®æ”¹ç¡®ä¿äº†åªæœ‰å®é™…çš„ç»„ä»¶ç±»ï¼ˆå¦‚æ§åˆ¶å™¨ã€æœåŠ¡ç±»ç­‰ï¼‰ä¼šè¢«æ³¨å†Œä¸º Bean

#### ç›¸å…³å½±å“
- è§£å†³äº† Tomcat å¯åŠ¨æ—¶çš„ NoSuchMethodException é”™è¯¯
- ä¼˜åŒ–äº†ç»„ä»¶æ‰«æé€»è¾‘ï¼Œé¿å…äº†ä¸å¿…è¦çš„æ³¨è§£ç±»å®ä¾‹åŒ–
- æé«˜äº†æ¡†æ¶çš„å¥å£®æ€§ 